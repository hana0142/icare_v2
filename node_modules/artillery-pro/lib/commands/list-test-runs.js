/** @license
 * (c) 2021 Shoreditch Ops Ltd. All rights reserved.
 *
 * This file is part of Artillery Pro (https://artillery.io)
 *
 * NOTICE: All information contained herein is, and remains
 * the property of Shoreditch Ops Ltd. The intellectual and
 * technical concepts contained herein are proprietary to
 * Shoreditch Ops Ltd and are protected by copyright law.
 *
 * Modification and/or redistribution of this material is
 * strictly forbidden unless prior written permission is
 * obtained from Shoreditch Ops Ltd.
 *
 */

module.exports = { listTestRuns: listTestRunsCommand };

const debug = require('debug')('commands:list-test-runs');

const { listTestRuns } = require('../data-api/list-test-runs');

async function listTestRunsCommand(options) {
  const tags = [];
  if (options.tags) {
    const ts = options.tags.split(',').map(x => x.trim());
    for(const t of ts) {
      const cs = t.split(':');
      if(cs.length !== 2) {
        console.error(`Invalid tag, skipping: ${t}`);
      } else {
        tags.push({name: cs[0], value: cs[1]});
      }
    }
  }

  debug({tags});

  try {
    const results = await listTestRuns(tags);
    console.log(JSON.stringify(results));
  }
  catch (err) {
    console.error('Something went wrong');
    console.error(err);
    process.exit(1);
  }
}
